
Desugared:

	(letrec (types ()) (values ((f (fn x ((. y) x)))))
	 (letrec (types ())
	  (values
	   ((a (f (letrec (types ()) (values ((y {}))) (((.= y) {}) y))))
	    (b
	     (f
	      (letrec (types ())
	       (values ((y (letrec (types ()) (values ((z {}))) (((.= z) {}) z)))))
	       (((.= y) {}) y))))))
	  (((.= a) (((.= b) {}) b)) a)))

inferred type:

	(record (types ())
	 (values
	  ((a (record (types ()) (values ())))
	   (b (record (types ()) (values ((z (record (types ()) (values ()))))))))))

Runtime term:

	(LetRec
	 (((0 (Lam (0 () (App ((GetField y) (Var 0)))))))
	  (LetRec
	   (((3
	      (App
	       ((Var 2)
	        (LetRec
	         (((0 (Record ())))
	          (App
	           ((App
	             ((Lam
	               (0 ()
	                (Lam (1 () (Update (old (Var 1)) (label y) (field (Var 0)))))))
	              (Record ())))
	            (Var 0))))))))
	     (3
	      (App
	       ((Var 2)
	        (LetRec
	         (((0
	            (LetRec
	             (((0 (Record ())))
	              (App
	               ((App
	                 ((Lam
	                   (0 ()
	                    (Lam
	                     (1 () (Update (old (Var 1)) (label z) (field (Var 0)))))))
	                  (Record ())))
	                (Var 0)))))))
	          (App
	           ((App
	             ((Lam
	               (0 ()
	                (Lam (1 () (Update (old (Var 1)) (label y) (field (Var 0)))))))
	              (Record ())))
	            (Var 0)))))))))
	    (App
	     ((App
	       ((Lam
	         (0 () (Lam (1 () (Update (old (Var 1)) (label a) (field (Var 0)))))))
	        (App
	         ((App
	           ((Lam
	             (0 ()
	              (Lam (1 () (Update (old (Var 1)) (label b) (field (Var 0)))))))
	            (Record ())))
	          (Var 1)))))
	      (Var 0)))))))

Evaluated:

	(Record ((a (Record ())) (b (Record ((z (Record ())))))))
