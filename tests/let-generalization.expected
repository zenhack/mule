
Desugared:

	(letrec (types ()) (values ((f (fn x x))))
	 (letrec (types ()) (values ((a (f (fn y y))) (b (f ((fn x (Ok x)) {})))))
	  (((.= a) (((.= b) {}) b)) a)))

inferred type:

	(all a
	 (all b
	  (all c
	   (all d
	    (record (types (...d))
	     (values
	      ((a (a -> a))
	       (b (union ((Ok (record (types (...c)) (values ()))) ...b))))))))))

Runtime term:

	(LetRec
	 (((0 (Lam (0 () (Var 0)))))
	  (LetRec
	   (((2 (App ((Var 2) (Lam (0 () (Var 0))))))
	     (2 (App ((Var 2) (App ((Lam (0 () (Ctor (Ok (Var 0))))) (Record ())))))))
	    (App
	     ((App
	       ((Lam
	         (0 () (Lam (1 () (Update (old (Var 1)) (label a) (field (Var 0)))))))
	        (App
	         ((App
	           ((Lam
	             (0 ()
	              (Lam (1 () (Update (old (Var 1)) (label b) (field (Var 0)))))))
	            (Record ())))
	          (Var 1)))))
	      (Var 0)))))))

Evaluated:

	(Record ((a (Lam (0 () (Var 0)))) (b (Ctor (Ok (Record ()))))))
